<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="pwned">Pwned</h1>

<p>An easy, Ruby way to use the Pwned Passwords API.</p>

<p><a href="https://rubygems.org/gems/pwned"><img src="https://badge.fury.io/rb/pwned.svg" alt="Gem Version" /></a> <a href="https://travis-ci.org/philnash/pwned"><img src="https://travis-ci.org/philnash/pwned.svg?branch=master" alt="Build Status" /></a> <a href="https://codeclimate.com/github/philnash/pwned/maintainability"><img src="https://codeclimate.com/github/philnash/pwned/badges/gpa.svg" alt="Maintainability" /></a> <a href="https://inch-ci.org/github/philnash/pwned"><img src="https://inch-ci.org/github/philnash/pwned.svg?branch=master" alt="Inline docs" /></a></p>

<table>
  <tbody>
    <tr>
      <td><a href="https://philnash.github.io/pwned/">API docs</a></td>
      <td><a href="https://github.com/philnash/pwned">GitHub repo</a></td>
    </tr>
  </tbody>
</table>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
  <li><a href="#about">About</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#usage">Usage</a>
    <ul>
      <li><a href="#plain-ruby">Plain Ruby</a></li>
      <li><a href="#activerecord-validator">Rails (ActiveRecord)</a></li>
      <li><a href="#devise">Devise</a></li>
    </ul>
  </li>
  <li><a href="#how-pwned-is-pi">How Pwned is Pi?</a></li>
  <li><a href="#development">Development</a></li>
  <li><a href="#contributing">Contributing</a></li>
  <li><a href="#license">License</a></li>
  <li><a href="#code-of-conduct">Code of Conduct</a></li>
</ul>

<h2 id="about">About</h2>

<p>Troy Hunt’s <a href="https://haveibeenpwned.com/API/v2#PwnedPasswords">Pwned Passwords API V2</a> allows you to check if a password has been found in any of the huge data breaches.</p>

<p><code>Pwned</code> is a Ruby library to use the Pwned Passwords API’s <a href="https://www.troyhunt.com/ive-just-launched-pwned-passwords-version-2/#cloudflareprivacyandkanonymity">k-Anonymity model</a> to test a password against the API without sending the entire password to the service.</p>

<p>The data from this API is provided by <a href="https://haveibeenpwned.com/">Have I been pwned?</a>. Before using the API, please check <a href="https://haveibeenpwned.com/API/v2#AcceptableUse">the acceptable uses and license of the API</a>.</p>

<p>Here is a blog post I wrote on <a href="https://www.twilio.com/blog/2018/03/better-passwords-in-ruby-applications-pwned-passwords-api.html">how to use this gem in your Ruby applications to make your users’ passwords better</a>.</p>

<h2 id="installation">Installation</h2>

<p>Add this line to your application’s Gemfile:</p>

<p><code>ruby
gem 'pwned'
</code></p>

<p>And then execute:</p>

<pre class="code ruby"><code class="ruby">$ bundle
</code></pre>

<p>Or install it yourself as:</p>

<pre class="code ruby"><code class="ruby">$ gem install pwned
</code></pre>

<h2 id="usage">Usage</h2>

<p>There are a few ways you can use this gem:</p>

<ol>
  <li><a href="#plain-ruby">Plain Ruby</a></li>
  <li><a href="#activerecord-validator">Rails</a></li>
  <li><a href="#devise">Rails and Devise</a></li>
</ol>

<h3 id="plain-ruby">Plain Ruby</h3>

<p>To test a password against the API, instantiate a <code>Pwned::Password</code> object and then ask if it is <code>pwned?</code>.</p>

<p><code>ruby
password = Pwned::Password.new("password")
password.pwned?
#=&gt; true
password.pwned_count
#=&gt; 3303003
</code></p>

<p>You can also check how many times the password appears in the dataset.</p>

<p><code>ruby
password = Pwned::Password.new("password")
password.pwned_count
#=&gt; 3303003
</code></p>

<p>Since you are likely using this as part of a signup flow, it is recommended that you rescue errors so if the service does go down, your user journey is not disturbed.</p>

<p><code>ruby
begin
  password = Pwned::Password.new("password")
  password.pwned?
rescue Pwned::Error =&gt; e
  # Ummm... don't worry about it, I guess?
end
</code></p>

<p>Most of the times you only care if the password has been pwned before or not. You can use simplified accessors to check whether the password has been pwned, or how many times it was pwned:</p>

<p><code>ruby
Pwned.pwned?("password")
#=&gt; true
Pwned.pwned_count("password")
#=&gt; 3303003
</code></p>

<h4 id="advanced">Advanced</h4>

<p>You can set http request options to be used with <code>Net::HTTP.start</code> when making the request to the API. These options are
documented in the <a href="http://ruby-doc.org/stdlib-2.6.3/libdoc/net/http/rdoc/Net/HTTP.html#method-c-start"><code>Net::HTTP.start</code> documentation</a>. The <code>:headers</code> option defines defines HTTP headers. These headers must be string keys.</p>

<p><code>ruby
password = Pwned::Password.new("password", headers: { 'User-Agent' =&gt; 'Super fun new user agent' }, read_timeout: 10)
</code></p>

<h3 id="activerecord-validator">ActiveRecord Validator</h3>

<p>There is a custom validator available for your ActiveRecord models:</p>

<p><code>ruby
class User &lt; ApplicationRecord
  validates :password, not_pwned: true
  # or
  validates :password, not_pwned: { message: "has been pwned %{count} times" }
end
</code></p>

<h4 id="i18n">I18n</h4>

<p>You can change the error message using I18n (use <code>%{count}</code> to interpolate the number of times the password was seen in the data breaches):</p>

<p><code>yaml
en:
  errors:
    messages:
      not_pwned: has been pwned %{count} times
      pwned_error: might be pwned
</code></p>

<h4 id="threshold">Threshold</h4>

<p>If you are ok with the password appearing a certain number of times before you decide it is invalid, you can set a threshold. The validator will check whether the <code>pwned_count</code> is greater than the threshold.</p>

<p><code>ruby
class User &lt; ApplicationRecord
  # The record is marked as valid if the password has been used once in the breached data
  validates :password, not_pwned: { threshold: 1 }
end
</code></p>

<h4 id="network-error-handling">Network Error Handling</h4>

<p>By default the record will be treated as valid when we cannot reach the <a href="https://haveibeenpwned.com/">haveibeenpwned.com</a> servers. This can be changed with the <code>:on_error</code> validator parameter:</p>

<p>```ruby
class User &lt; ApplicationRecord
  # The record is marked as valid on network errors.
  validates :password, not_pwned: true
  validates :password, not_pwned: { on_error: :valid }</p>

<p># The record is marked as invalid on network errors
  # (error message “could not be verified against the past data breaches”.)
  validates :password, not_pwned: { on_error: :invalid }</p>

<p># The record is marked as invalid on network errors with custom error.
  validates :password, not_pwned: { on_error: :invalid, error_message: “might be pwned” }</p>

<p># We will raise an error on network errors.
  # This means that <code>record.valid?</code> will raise <code>Pwned::Error</code>.
  # Not recommended to use in production.
  validates :password, not_pwned: { on_error: :raise_error }</p>

<p># Call custom proc on error. For example, capture errors in Sentry,
  # but do not mark the record as invalid.
  validates :password, not_pwned: {
    on_error: -&gt;(record, error) { Raven.capture_exception(error) }
  }
end
```</p>

<h4 id="custom-request-options">Custom Request Options</h4>

<p>You can configure network requests made from the validator using <code>:request_options</code> (see <a href="http://ruby-doc.org/stdlib-2.6.3/libdoc/net/http/rdoc/Net/HTTP.html#method-c-start">Net::HTTP.start</a> for the list of available options).
In addition to these options, HTTP headers can be specified with the <code>:headers</code> key, e.g. <code>"User-Agent"</code>):</p>

<p><code>ruby
  validates :password, not_pwned: {
    request_options: { read_timeout: 5, open_timeout: 1, headers: { "User-Agent" =&gt; "Super fun user agent" } }
  }
</code></p>

<h3 id="devise">Devise</h3>

<p>If you are using Devise I recommend you use the <a href="https://github.com/michaelbanfield/devise-pwned_password">devise-pwned_password extension</a> which is now powered by this gem.</p>

<h2 id="how-pwned-is-pi">How Pwned is Pi?</h2>

<p><a href="https://github.com/daz">@daz</a> <a href="https://twitter.com/dazonic/status/1074647842046660609">shared</a> a fantastic example of using this gem to show how many times the digits of Pi have been used as passwords and leaked.</p>

<p>```ruby
require ‘pwned’</p>

<p>PI = ‘3.14159265358979323846264338327950288419716939937510582097494459230781640628620899862803482534211706798214808651328230664709384460955058223172535940812848111’</p>

<p>for n in 1..40
  password = Pwned::Password.new PI[0..(n + 1)]
  str = [ n.to_s.rjust(2) ]
  str « (password.pwned? ? ‘😡’ : ‘😃’)
  str « password.pwned_count.to_s.rjust(4)
  str « password.password</p>

<p>puts str.join ‘ ‘
end
```</p>

<p>The results may, or may not, surprise you.</p>

<p><code>
 1 😡   16 3.1
 2 😡  238 3.14
 3 😡   34 3.141
 4 😡 1345 3.1415
 5 😡 2552 3.14159
 6 😡  791 3.141592
 7 😡 9582 3.1415926
 8 😡 1591 3.14159265
 9 😡  637 3.141592653
10 😡  873 3.1415926535
11 😡  137 3.14159265358
12 😡  103 3.141592653589
13 😡   65 3.1415926535897
14 😡  201 3.14159265358979
15 😡   41 3.141592653589793
16 😡   57 3.1415926535897932
17 😡   28 3.14159265358979323
18 😡   29 3.141592653589793238
19 😡    1 3.1415926535897932384
20 😡    7 3.14159265358979323846
21 😡    5 3.141592653589793238462
22 😡    2 3.1415926535897932384626
23 😡    2 3.14159265358979323846264
24 😃    0 3.141592653589793238462643
25 😡    3 3.1415926535897932384626433
26 😃    0 3.14159265358979323846264338
27 😃    0 3.141592653589793238462643383
28 😃    0 3.1415926535897932384626433832
29 😃    0 3.14159265358979323846264338327
30 😃    0 3.141592653589793238462643383279
31 😃    0 3.1415926535897932384626433832795
32 😃    0 3.14159265358979323846264338327950
33 😃    0 3.141592653589793238462643383279502
34 😃    0 3.1415926535897932384626433832795028
35 😃    0 3.14159265358979323846264338327950288
36 😃    0 3.141592653589793238462643383279502884
37 😃    0 3.1415926535897932384626433832795028841
38 😃    0 3.14159265358979323846264338327950288419
39 😃    0 3.141592653589793238462643383279502884197
40 😃    0 3.1415926535897932384626433832795028841971
</code></p>

<h2 id="development">Development</h2>

<p>After checking out the repo, run <code>bin/setup</code> to install dependencies. Then, run <code>rake spec</code> to run the tests. You can also run <code>bin/console</code> for an interactive prompt that will allow you to experiment.</p>

<p>To install this gem onto your local machine, run <code>bundle exec rake install</code>. To release a new version, update the version number in <code>version.rb</code>, and then run <code>bundle exec rake release</code>, which will create a git tag for the version, push git commits and tags, and push the <code>.gem</code> file to <a href="https://rubygems.org">rubygems.org</a>.</p>

<h2 id="contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at https://github.com/philnash/pwned. This project is intended to be a safe, welcoming space for collaboration, and contributors are expected to adhere to the <a href="http://contributor-covenant.org">Contributor Covenant</a> code of conduct.</p>

<h2 id="license">License</h2>

<p>The gem is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>

<h2 id="code-of-conduct">Code of Conduct</h2>

<p>Everyone interacting in the Pwned project’s codebases, issue trackers, chat rooms and mailing lists is expected to follow the <a href="https://github.com/philnash/pwned/blob/master/CODE_OF_CONDUCT.md">code of conduct</a>.</p>
</div></div>

      <div id="footer">
  Generated on Mon Jul 29 14:27:46 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20 (ruby-2.3.7).
</div>

    </div>
  </body>
</html>